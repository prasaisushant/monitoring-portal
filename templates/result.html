<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes Node Stats Results</title>
    <script>
        let fetchInterval = 5000; // Default interval of 5 seconds
        let intervalId;

        function fetchStats() {
            fetch('/stats')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('statsTableBody');
                    tableBody.innerHTML = '';  // Clear existing data

                    data.forEach(entry => {
                        entry.node_stats.forEach(stat => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${new Date(entry.timestamp * 1000).toLocaleString()}</td>
                                <td>${stat.node}</td>
                                <td>${stat.cpu_usage}</td>
                                <td>${stat.cpu_percentage}</td>
                                <td>${stat.memory_usage}</td>
                                <td>${stat.memory_percentage}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    });
                });
        }

        function updateInterval() {
            const newInterval = parseInt(document.getElementById('intervalInput').value) * 1000;
            if (intervalId) {
                clearInterval(intervalId); // Clear the existing interval
            }
            fetchInterval = newInterval;
            fetchStats(); // Fetch immediately
            intervalId = setInterval(fetchStats, fetchInterval); // Set the new interval
            // Update server-side interval
            fetch('/update_interval', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ interval: newInterval / 1000 }) // Send interval in seconds
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            intervalId = setInterval(fetchStats, fetchInterval); // Initialize with default interval
        });
    </script>
</head>
<body>
    <h1>Kubernetes Node Stats</h1>
    <label for="intervalInput">Update Interval (seconds):</label>
    <input type="number" id="intervalInput" value="5" min="1">
    <button onclick="updateInterval()">Update Interval</button>
    
    <table border="1">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Node</th>
                <th>CPU Usage (m)</th>
                <th>CPU Percentage</th>
                <th>Memory Usage (Mi)</th>
                <th>Memory Percentage</th>
            </tr>
        </thead>
        <tbody id="statsTableBody">
            <!-- Data will be injected here -->
        </tbody>
    </table>
    <br>
    <a href="/">Back</a>
</body>
</html>
